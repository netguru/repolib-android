ext {
    if (isBitrise) {
        keyProperty = { var, defVal = "undefined" ->
            prop = System.getenv(var)
            if (prop == null || prop.isEmpty()) {
                if (bitrise.cli.isPr) {
                    prop = defVal
                } else {
                    throw new MissingPropertyException("Missing environment variable $var")
                }
            }
            prop
        }
    } else {
        keyConfigPath = "${projectDir.path}/secret.properties"
        File keyConfigFile = file(keyConfigPath)
        keyProps = new Properties();

        if (keyConfigFile.exists()) {
            keyProps.load(keyConfigFile.newInputStream())
        } else if (!isBitrise) {
            throw new FileNotFoundException("File $keyConfigPath not found")
        }

        keyProperty = { var, defVal = "undefined" ->
            propNameCase = var
            prop = keyProps[propNameCase]
            if (prop == null || prop.toString().isEmpty())
                throw new MissingPropertyException("Missing property $propNameCase")
            prop
        }
    }
}